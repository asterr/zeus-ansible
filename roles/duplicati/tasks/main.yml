---
# tasks file for duplicati
- name: Create /mnt_rw
  ansible.builtin.file:
    path: /mnt_rw
    state: directory

- name: Mount /mnt_rw on tmpfs
  ansible.posix.mount:
    path: /mnt_rw
    src: tmpfs
    fstype: tmpfs
    opts: size=20m
    state: mounted

- name: Change /mnt to RO bind mount
  ansible.posix.mount:
    path: /mnt
    src: /mnt_rw
    fstype: none
    opts: bind,ro
    state: mounted

- name: Install smbcredentials
  ansible.builtin.copy:
    src: smbcredentials
    dest: /home/asterr/.smbcredentials
    owner: asterr
    group: asterr
    mode: u=rw,g-rwx,o-rwx
    backup: yes

- name: Install cifs-utils
  ansible.builtin.apt:
    name: cifs-utils
    state: latest
